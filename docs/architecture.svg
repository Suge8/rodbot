<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 520">
  <defs>
    <style>
      .t{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif}
      @keyframes dashFlow{from{stroke-dashoffset:0}to{stroke-dashoffset:-20}}
      @keyframes expLoop{from{stroke-dashoffset:0}to{stroke-dashoffset:-24}}
      @keyframes corePulse{
        0%,100%{stroke:#00d4ff;filter:drop-shadow(0 0 6px #00d4ff33)}
        50%{stroke:#38bdf8;filter:drop-shadow(0 0 20px #00d4ff66)}
      }
      @keyframes nodeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
      .flow{stroke:#00d4ff;stroke-width:1.5;fill:none;stroke-dasharray:6 8;animation:dashFlow 2s linear infinite;opacity:.6}
      .exp{stroke:#22c55e;stroke-width:2;fill:none;stroke-dasharray:8 6;animation:expLoop 2.5s linear infinite;opacity:.5}
      .core-glow{animation:corePulse 3.5s ease-in-out infinite}
      .n{animation:nodeIn .6s ease-out both}
      .n1{animation-delay:.1s}.n2{animation-delay:.2s}.n3{animation-delay:.3s}
      .n4{animation-delay:.4s}.n5{animation-delay:.5s}
    </style>
    <linearGradient id="bg" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#0a0e17"/>
      <stop offset="100%" stop-color="#0d1220"/>
    </linearGradient>
    <pattern id="dots" width="24" height="24" patternUnits="userSpaceOnUse">
      <circle cx="12" cy="12" r=".4" fill="#1e293b" opacity=".4"/>
    </pattern>
    <marker id="ac" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3z" fill="#00d4ff" opacity=".6"/>
    </marker>
    <marker id="ag" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3z" fill="#22c55e" opacity=".6"/>
    </marker>
    <radialGradient id="coreGlow" cx=".5" cy=".5" r=".5">
      <stop offset="0%" stop-color="#00d4ff" stop-opacity=".04"/>
      <stop offset="100%" stop-color="#00d4ff" stop-opacity="0"/>
    </radialGradient>
  </defs>

  <!-- Background -->
  <rect width="800" height="520" fill="url(#bg)" rx="16"/>
  <rect width="800" height="520" fill="url(#dots)" rx="16"/>

  <!-- ═══ INPUT (Left) ═══ -->
  <g class="n n1">
    <text x="46" y="84" class="t" fill="#6b7280" font-size="9" font-weight="700" letter-spacing="1">INPUT</text>
    <rect x="16" y="96" width="76" height="36" rx="8" fill="#111827" stroke="#1f2937" stroke-width="1"/>
    <text x="54" y="119" class="t" fill="#d1d5db" font-size="11" font-weight="600" text-anchor="middle">User</text>
    <rect x="16" y="146" width="76" height="36" rx="8" fill="#111827" stroke="#1f2937" stroke-width="1"/>
    <text x="54" y="162" class="t" fill="#d1d5db" font-size="10" font-weight="600" text-anchor="middle">Cron</text>
    <text x="54" y="175" class="t" fill="#6b7280" font-size="8" text-anchor="middle">Heartbeat</text>
  </g>

  <!-- ═══ CHANNELS (Center-Left) ═══ -->
  <g class="n n2">
    <text x="170" y="44" class="t" fill="#6b7280" font-size="9" font-weight="700" letter-spacing="1">9 CHANNELS</text>
    <rect x="118" y="54" width="140" height="260" rx="10" fill="none" stroke="#1f2937" stroke-width="1" stroke-dasharray="4 3"/>
    <!-- Pills grid -->
    <rect x="128" y="68" width="58" height="22" rx="11" fill="#1e293b"/>
    <text x="157" y="83" class="t" fill="#9ca3af" font-size="9" text-anchor="middle">Telegram</text>
    <rect x="192" y="68" width="58" height="22" rx="11" fill="#1e293b"/>
    <text x="221" y="83" class="t" fill="#9ca3af" font-size="9" text-anchor="middle">Discord</text>
    <rect x="128" y="96" width="58" height="22" rx="11" fill="#1e293b"/>
    <text x="157" y="111" class="t" fill="#9ca3af" font-size="9" text-anchor="middle">WhatsApp</text>
    <rect x="192" y="96" width="58" height="22" rx="11" fill="#1e293b"/>
    <text x="221" y="111" class="t" fill="#9ca3af" font-size="9" text-anchor="middle">Slack</text>
    <rect x="128" y="124" width="58" height="22" rx="11" fill="#1e293b"/>
    <text x="157" y="139" class="t" fill="#9ca3af" font-size="9" text-anchor="middle">Feishu</text>
    <rect x="192" y="124" width="58" height="22" rx="11" fill="#1e293b"/>
    <text x="221" y="139" class="t" fill="#9ca3af" font-size="9" text-anchor="middle">Email</text>
    <rect x="128" y="152" width="58" height="22" rx="11" fill="#1e293b"/>
    <text x="157" y="167" class="t" fill="#9ca3af" font-size="9" text-anchor="middle">QQ</text>
    <rect x="192" y="152" width="58" height="22" rx="11" fill="#1e293b"/>
    <text x="221" y="167" class="t" fill="#9ca3af" font-size="9" text-anchor="middle">DingTalk</text>
    <rect x="160" y="180" width="58" height="22" rx="11" fill="#1e293b"/>
    <text x="189" y="195" class="t" fill="#9ca3af" font-size="9" text-anchor="middle">Mochat</text>
    <!-- Bus -->
    <rect x="130" y="214" width="116" height="24" rx="6" fill="#111827" stroke="#00d4ff" stroke-width=".6"/>
    <text x="188" y="230" class="t" fill="#00d4ff" font-size="9" font-weight="600" text-anchor="middle">Message Bus</text>
    <!-- Subagent -->
    <rect x="130" y="250" width="116" height="50" rx="6" fill="#111827" stroke="#3b82f6" stroke-width=".6"/>
    <text x="188" y="272" class="t" fill="#d1d5db" font-size="10" font-weight="600" text-anchor="middle">Subagent</text>
    <text x="188" y="290" class="t" fill="#6b7280" font-size="8" text-anchor="middle">Background Tasks</text>
  </g>

  <!-- ═══ AGENT CORE (Center) ═══ -->
  <g class="n n3">
    <text x="380" y="44" class="t" fill="#00d4ff" font-size="9" font-weight="700" letter-spacing="1" text-anchor="middle">AGENT CORE  ~4,100 LINES</text>
    <rect x="276" y="54" width="210" height="284" rx="12" fill="#0a0e17" stroke="#00d4ff" stroke-width="2" class="core-glow"/>
    <rect x="276" y="54" width="210" height="284" rx="12" fill="url(#coreGlow)"/>
    <!-- Modules -->
    <rect x="290" y="72" width="182" height="38" rx="6" fill="#111827" stroke="#a855f7" stroke-width=".8"/>
    <text x="381" y="96" class="t" fill="#e2e8f0" font-size="11" font-weight="600" text-anchor="middle">Thinking Protocol</text>
    <rect x="290" y="122" width="182" height="48" rx="6" fill="#111827" stroke="#22c55e" stroke-width=".8"/>
    <text x="381" y="144" class="t" fill="#e2e8f0" font-size="11" font-weight="600" text-anchor="middle">Context Builder</text>
    <text x="381" y="160" class="t" fill="#6b7280" font-size="9" text-anchor="middle">+ Experience Injection</text>
    <rect x="290" y="182" width="182" height="48" rx="6" fill="#111827" stroke="#f59e0b" stroke-width=".8"/>
    <text x="381" y="204" class="t" fill="#e2e8f0" font-size="11" font-weight="600" text-anchor="middle">Tool Executor</text>
    <text x="381" y="220" class="t" fill="#6b7280" font-size="9" text-anchor="middle">+ Retry / Reflection</text>
    <rect x="290" y="242" width="86" height="36" rx="6" fill="#111827" stroke="#374151" stroke-width=".6"/>
    <text x="333" y="264" class="t" fill="#9ca3af" font-size="9" font-weight="600" text-anchor="middle">Utility Model</text>
    <rect x="386" y="242" width="86" height="36" rx="6" fill="#111827" stroke="#374151" stroke-width=".6"/>
    <text x="429" y="264" class="t" fill="#9ca3af" font-size="9" font-weight="600" text-anchor="middle">Cache</text>
    <rect x="290" y="290" width="182" height="24" rx="6" fill="#111827" stroke="#374151" stroke-width=".4"/>
    <text x="381" y="306" class="t" fill="#6b7280" font-size="8" text-anchor="middle">Skills Loader + Heartbeat</text>
  </g>

  <!-- ═══ RESOURCES (Right) ═══ -->
  <g class="n n4">
    <text x="648" y="44" class="t" fill="#6b7280" font-size="9" font-weight="700" letter-spacing="1" text-anchor="middle">RESOURCES</text>
    <!-- Providers -->
    <rect x="516" y="56" width="264" height="82" rx="8" fill="#111827" stroke="#1f2937" stroke-width="1"/>
    <text x="648" y="78" class="t" fill="#e2e8f0" font-size="11" font-weight="600" text-anchor="middle">LLM Providers</text>
    <text x="648" y="96" class="t" fill="#6b7280" font-size="9" text-anchor="middle">OpenRouter / Anthropic / OpenAI</text>
    <text x="648" y="112" class="t" fill="#6b7280" font-size="9" text-anchor="middle">DeepSeek / Gemini / Groq / 16+ total</text>
    <text x="648" y="128" class="t" fill="#4b5563" font-size="8" text-anchor="middle">Add yours in 2 steps</text>
    <!-- MCP -->
    <rect x="516" y="152" width="264" height="52" rx="8" fill="#111827" stroke="#1f2937" stroke-width="1"/>
    <text x="648" y="176" class="t" fill="#e2e8f0" font-size="11" font-weight="600" text-anchor="middle">MCP Tools</text>
    <text x="648" y="194" class="t" fill="#6b7280" font-size="9" text-anchor="middle">stdio + HTTP | Claude/Cursor compatible</text>
    <!-- Skills -->
    <rect x="516" y="218" width="264" height="52" rx="8" fill="#111827" stroke="#1f2937" stroke-width="1"/>
    <text x="648" y="242" class="t" fill="#e2e8f0" font-size="11" font-weight="600" text-anchor="middle">Skills</text>
    <text x="648" y="260" class="t" fill="#6b7280" font-size="9" text-anchor="middle">GitHub / Cron / Weather / Custom</text>
  </g>

  <!-- ═══ PERSISTENT LAYER (Bottom) ═══ -->
  <g class="n n5">
    <rect x="16" y="366" width="768" height="136" rx="10" fill="#0a0e17" stroke="#1f2937" stroke-width="1"/>
    <text x="400" y="390" class="t" fill="#00d4ff" font-size="9" font-weight="700" letter-spacing="1" text-anchor="middle">PERSISTENT LAYER  —  LanceDB</text>
    <rect x="32" y="404" width="230" height="80" rx="8" fill="#111827" stroke="#1f2937" stroke-width=".6"/>
    <text x="147" y="430" class="t" fill="#d1d5db" font-size="11" font-weight="600" text-anchor="middle">Long-term Memory</text>
    <text x="147" y="448" class="t" fill="#6b7280" font-size="9" text-anchor="middle">User prefs, project facts</text>
    <text x="147" y="464" class="t" fill="#6b7280" font-size="9" text-anchor="middle">Auto-consolidation</text>
    <rect x="278" y="404" width="230" height="80" rx="8" fill="#111827" stroke="#1f2937" stroke-width=".6"/>
    <text x="393" y="430" class="t" fill="#d1d5db" font-size="11" font-weight="600" text-anchor="middle">Conversation History</text>
    <text x="393" y="448" class="t" fill="#6b7280" font-size="9" text-anchor="middle">Session context</text>
    <text x="393" y="464" class="t" fill="#6b7280" font-size="9" text-anchor="middle">Trajectory compression</text>
    <rect x="524" y="404" width="244" height="80" rx="8" fill="#111827" stroke="#22c55e" stroke-width=".6"/>
    <text x="646" y="426" class="t" fill="#22c55e" font-size="11" font-weight="600" text-anchor="middle">Experience Store</text>
    <text x="646" y="444" class="t" fill="#6b7280" font-size="9" text-anchor="middle">Lessons / strategies / keywords</text>
    <text x="646" y="460" class="t" fill="#6b7280" font-size="9" text-anchor="middle">Confidence calibration</text>
    <text x="646" y="476" class="t" fill="#6b7280" font-size="9" text-anchor="middle">Active forgetting</text>
  </g>

  <!-- ═══ CONNECTIONS ═══ -->
  <!-- Input → Channels -->
  <path d="M92 114 L118 114" class="flow" marker-end="url(#ac)"/>
  <path d="M92 164 L108 164 L108 180 L118 180" class="flow" marker-end="url(#ac)"/>
  <!-- Channels → Core -->
  <path d="M258 190 L276 190" class="flow" marker-end="url(#ac)"/>
  <!-- Core → Providers -->
  <path d="M486 100 L516 100" class="flow" marker-end="url(#ac)"/>
  <!-- Core → MCP -->
  <path d="M486 180 L516 180" class="flow" marker-end="url(#ac)"/>
  <!-- Core → Skills -->
  <path d="M486 244 L516 244" class="flow" marker-end="url(#ac)"/>
  <!-- Core → Persistent -->
  <path d="M381 338 L381 366" class="flow" marker-end="url(#ac)"/>

  <!-- ═══ EXPERIENCE FEEDBACK LOOP ═══ -->
  <path d="M660 404 L660 350 L500 350 L500 170 L486 170" class="exp" marker-end="url(#ag)"/>
  <path d="M460 338 L460 350 L630 350 L630 404" class="exp" marker-end="url(#ag)"/>
  <rect x="504" y="342" width="100" height="16" rx="8" fill="#22c55e12"/>
  <text x="554" y="354" class="t" fill="#22c55e" font-size="8" font-weight="600" text-anchor="middle">Experience Loop</text>
</svg>
